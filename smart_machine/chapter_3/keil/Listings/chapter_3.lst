C51 COMPILER V9.60.7.0   CHAPTER_3                                                         04/22/2024 11:15:07 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE CHAPTER_3
OBJECT MODULE PLACED IN .\Objects\chapter_3.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\chapter_3.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\chapter_3.lst) TABS(2) OBJECT(.\Objects\chapter_3.obj)

line level    source

   1          #include "chapter_3.h"
   2          
   3          
   4          void main(void)
   5          {
   6   1        uchar key_pos = 0;
   7   1        uchar Code [] = {0x1c,0x1d,0x1e,0x00,0x01,0x02,0x03};
   8   1        uchar index;
   9   1      
  10   1        //LCD初始化
  11   1        Init();
  12   1        Clear();
  13   1      
  14   1        //display name
  15   1        for(index = 0; index < 2; index++)
  16   1        {
  17   2          Page_ = 0x03;
  18   2          Column = (0x00+index)<<4 + 5;
  19   2          Code_ = Code[index];
  20   2          WriteCHN16x16(Page_,Column,Code_);
  21   2        }
  22   1        while(read_key() == 0xff);
  23   1        Clear();
  24   1        
  25   1        while(1)
  26   1        {
  27   2          key_pos = read_key();
  28   2          if(key_pos != 0xff)
  29   2            precess_keyfn(KEY_NUMBER[key_pos]);
  30   2          
  31   2        }
  32   1        
  33   1      }
  34          
  35          
  36          unsigned char read_key(void)
  37          {
  38   1        unsigned char scan_data = 0x20;//列扫描用IO输出数据
  39   1        unsigned char row = 0, col = 0;
  40   1        unsigned char key_pos = 0xff;
  41   1        //检测是否有按键按下
  42   1        XBYTE[ADDR_KEY_WRITE] = 0x00;
  43   1        if((XBYTE[ADDR_KEY_READ] & 0x0f) != 0x0f)//有按键按下
  44   1        {
  45   2          //按键消抖
  46   2          Delay5ms();
  47   2          
  48   2          //进行列检测
  49   2          XBYTE[ADDR_KEY_WRITE] = scan_data;
  50   2          while((XBYTE[ADDR_KEY_READ] & 0x0f) != 0x0f)//检测到0x0f时即找到该列
  51   2          {
  52   3            col ++;
  53   3            scan_data  = scan_data >> 1;
  54   3            XBYTE[ADDR_KEY_WRITE] = scan_data;
C51 COMPILER V9.60.7.0   CHAPTER_3                                                         04/22/2024 11:15:07 PAGE 2   

  55   3          }
  56   2          
  57   2          //进行行检测
  58   2          XBYTE[ADDR_KEY_WRITE] = 0x00;
  59   2          switch(XBYTE[ADDR_KEY_READ] & 0x0f)
  60   2          {
  61   3            case 0x07:row = 0;break;
  62   3            case 0x0b:row = 1;break;
  63   3            case 0x0d:row = 2;break;
  64   3            case 0x0e:row = 3;break;
  65   3            default:return 0xff;
  66   3            
  67   3          }
  68   2          //合成按键位置
  69   2          key_pos = row*6 + col;
  70   2          while((XBYTE[ADDR_KEY_READ] & 0x0f) != 0x0f);
  71   2          return key_pos;
  72   2        }
  73   1        else
  74   1          return 0xff;
  75   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    222    ----
   CONSTANT SIZE    =    927    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
